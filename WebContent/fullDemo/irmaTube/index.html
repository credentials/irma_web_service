<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="keywords" content="IRMA, IRMATube, film, privacy, security">
	<meta name="description"
		content="Experimental IRMATube video streaming service">

	<title>IRMATube - Watch movies without others noticing it!</title>

	<link href="../../css/irma.css" rel="stylesheet" type="text/css" />
	<link href="../../css/mosaic.css" rel="stylesheet" type="text/css" />
	<link href="../../css/bootstrap.css" rel="stylesheet" type="text/css" />
	<link href="css/irmatube.css" rel="stylesheet" type="text/css" />

	<script src="../../js/jquery-1.8.1.min.js" type="text/javascript"></script>
	<script src="../../js/mosaic.1.0.1.min.js" type="text/javascript"></script>
	<script src="../../js/mustache.js" type="text/javascript"></script>
	<script src="content/movies.js" type="text/javascript"></script>

	<script src="../../js/smartcardjs.js" type="text/javascript"></script>
	<script src="../../js/channel.js" type="text/javascript"></script>
	<script src="../../js/ProxyReader.js" type="text/javascript"></script>
	<script src="../../js/bootstrap.min.js" type="text/javascript"></script>
	<script src="../../js/irma.js" type="text/javascript"></script>

	<script id="moviePlayerTpl" type="text/template">
		<div class="video-overlay" id="video_div_{{id}}">
			<video controls="controls" preload="none" id="video_{{id}}" height="400" width="700">
				<source src="{{url}}/{{id}}.webm" type="video/webm">
				<source src="{{url}}/{{id}}.mp4" type="video/mp4">
				Your browser does not support the video tag.
			</video>
			<button onclick="closeMovie('{{id}}')">Close</button>
		</div>
    </script>
	<script id="movieTpl" type="text/template">
		<div id="movie_{{id}}_wrapper">
		<!-- moviePlayer template goes here -->
		<div class="mosaic-block bar" id="movie_{{id}}">
			<span href="#" onclick="openMovie('{{id}}', '{{ageLimit}}');" class="mosaic-overlay">
				<h4>{{title}}
				{{#ageLimit}}
				<a target='_blank' href='IRMA-age-reference.html'>
					<img src='img/movieage-{{ageLimit}}.png' />
				</a>
				{{/ageLimit}}
				</h4>
			</span>

			<div class="mosaic-backdrop">
				<img alt="{{title}}" src="content/{{id}}.jpg">
			</div>
		</div>
		</div>
	</script>

	<script type="text/javascript">
		function openMovie(videoNumber, ageLimit) {
			IRMA.base_url = "/irma_web_service/protocols/verification/IRMATube/" + ageLimit;
			$("#irmaTube").hide();

			IRMA.onVerifySuccess = function(data) {
				IRMA.hide_verify();
				console.log(data);

				$("#irmaTube").fadeIn();

				var data = {id: videoNumber,
							url: data.result};
				var video_template = $("#moviePlayerTpl").html();
				$("#movie_" + videoNumber + "_wrapper").prepend(Mustache.to_html(video_template, data));

				$("#video_div_" + videoNumber).css("display", "block");
				$("#video_" + videoNumber).get(0).load();
				$("#video_" + videoNumber).get(0).play();
			}

			IRMA.onBackButtonPressed = function(data) {
				IRMA.hide_verify();
				IRMA.hide_issue();
				$("#irmaTube").show();
			}

			IRMA.start_verify();
		}

		function closeMovie(videoNumber) {
			$("#video_div_" + videoNumber).css("display", "none");
			$("#video_" + videoNumber).get(0).pause();
			$("#video_div_" + videoNumber).remove();
		}

		$(function() {
			IRMA.init();

			var template = $("#movieTpl").html();
			console.log(IRMATubeMovies);
			for ( var i = 0; i < IRMATubeMovies.length; i++) {
				movie = IRMATubeMovies[i];
				console.log(movie);
				$("#movies").append(Mustache.to_html(template, movie));
				$("#movie_" + movie.id).mosaic({
					animation : 'slide'
				});
			}
		});
	</script>
</head>

<body>
	<div id="irmaTube">
	<br>

	<a href="http://www.irmacard.org/"><img src="img/IRMATube_logo.png"
		width="200" /></a>
	<div>
		<img src="img/arrows_blue_animated.gif" id="arrow" />
		IRMATube is the privacy-friendly video-streaming service
	</div>

	<div id="movies"></div>
	</div>

	<object classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93" height="10" width="10">
      <param name="code" value="org.irmacard.scjs.SmartCardJS.class" />
      <param name="archive" value="../../smartcardjs.jar" />
      <param name="type" value="application/x-java-applet;version=1.6" />
      <param name="scriptable" value="true" />
      <param name="mayscript" value="true" />
      <embed type="application/x-java-applet;version=1.6" code="org.irmacard.scjs.SmartCardJS.class" archive="../../smartcardjs.jar" scriptable="true" mayscript="true" hidden="true" height="10" width="10" />
  </object>
</body>
</html>
